// ============================================================================
// VIADEO GRAPH API CONNECTOR -- NODE.JS FRAMEWORK FOR A BETTER WORLD WITH APIs
//                   XLP - eXecution and Loading Planner
// ============================================================================
//             www.viadeo.com - api.video.com - dev.viadeo.com
//
//             Copyright (C) Viadeo 2011 - All rights reserved
// ============================================================================
//
// - Viadeo-specific i18n parsing
//
// @author Lo√Øc Dias Da Silva <ldiasdasilva@viadeoteam.com> 
// ============================================================================

var vm = require('vm');
var fs = require('fs');

exports.linguaResourceParser = function(path, file) {
    var content = fs.readFileSync(path + file, 'UTF-8');

    if ( ! /^language\.[a-z-]+\.js$/.test(file) ) {
        new Error("translation file must use the format language.<lang>.js: " + file);
    }

    content += "\ntranslates = lang;";
    translates = {}; // Global var
    var script = vm.createScript(content, file);
    script.runInThisContext();

    var locale = file.replace('.js', '').replace('language.', '');

    return {
        locale: locale,
        content: translates
    };
};

exports.linguaSentenceParser = function(sentence, arrayParams) {
    if ( arrayParams ) {
        var prefix = "@var";
        for (var i = 0; i < arrayParams.length; i++){
            sentence = sentence.replace(prefix + i, arrayParams[i]);
        }
    }
    return sentence;
}

